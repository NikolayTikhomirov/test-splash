
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Подключение к интернету — Captive Portal</title>
  <meta name="description" content="Кнопка для подключения к интернету в гостевых сетях с captive portal (Meraki/UniFi/MikroTik/Coova)." />
  <style>
    :root{--bg:#0b0f19;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--brand:#60a5fa;--brand2:#34d399}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:
      radial-gradient(1000px 700px at 80% -20%, #1f2937 0%, transparent 60%),
      radial-gradient(700px 500px at -20% 100%, #0f766e 0%, transparent 60%), var(--bg);
      display:grid;place-items:center;padding:24px}
    .wrap{max-width:820px;width:100%}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.1);
      border-radius:22px;padding:30px;backdrop-filter:blur(6px);box-shadow:0 16px 50px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:clamp(26px,4vw,40px)}
    p{margin:8px 0 0;color:var(--muted)}
    .btn{margin-top:22px;appearance:none;border:none;cursor:pointer;border-radius:14px;padding:14px 18px;font-size:16px;font-weight:700;
      background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0b0f19;transition:transform .08s ease, box-shadow .2s ease;
      box-shadow:0 10px 25px rgba(96,165,250,.35)}
    .btn:disabled{opacity:.6;cursor:not-allowed;box-shadow:none}
    .btn:hover:not(:disabled){transform:translateY(-1px)}
    code{background:#0d1320;border:1px solid rgba(255,255,255,.1);padding:2px 6px;border-radius:8px}
    .hint{margin-top:16px;font-size:14px;color:var(--muted)}
    .ok{color:#a7f3d0}
    .err{color:#fca5a5}
    .kv{margin-top:12px;font-size:14px}
    .kv dt{color:#9ca3af}
    .kv dd{margin:0 0 6px}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" role="region" aria-labelledby="title">
      <h1 id="title">Подключиться к интернету</h1>
      <p>Эта страница предназначена для гостевых Wi‑Fi сетей с <em>captive portal</em>. Нажмите кнопку ниже, чтобы завершить авторизацию.</p>

      <button id="connectBtn" class="btn" disabled>Подключиться</button>
      <p id="status" class="hint">Инициализация…</p>

      <dl class="kv" id="kv"></dl>

      <p class="hint">Поддерживаются: Meraki ( <code>base_grant_url</code> + <code>user_continue_url</code> ), UniFi/MikroTik ( <code>grant_url</code> / <code>success_url</code> ), CoovaChilli/Chillispot (упрощённый click‑through).</p>
    </section>
  </main>

  <script>
    // Вспомогательные функции
    const qs = new URLSearchParams(location.search);
    const $ = (id)=>document.getElementById(id);
    const kv = (k,v)=>`<dt>${k}</dt><dd><code>${(v||'').toString()}</code></dd>`;

    const state = {
      base_grant_url: qs.get('base_grant_url'),   // Meraki
      user_continue_url: qs.get('user_continue_url') || qs.get('continue_url') || 'https://example.com/',
      grant_url: qs.get('grant_url'),             // UniFi/MikroTik/прочие
      success_url: qs.get('success_url'),
      login_url: qs.get('login_url'),             // иногда встречается
    };

    function showContext(){
      const el = $('kv');
      el.innerHTML = ''
        + kv('base_grant_url', state.base_grant_url)
        + kv('user_continue_url', state.user_continue_url)
        + kv('grant_url', state.grant_url)
        + kv('success_url', state.success_url)
        + kv('login_url', state.login_url);
    }

    function setStatus(text, ok=false){
      const s=$('status'); s.textContent=text; s.className = 'hint ' + (ok? 'ok':'');
    }

    function enable(btn){ btn.disabled=false; }

    async function connect(){
      try{
        // Вариант A: Meraki EXCAP — нужно открыть base_grant_url с continue_url
        if(state.base_grant_url){
          const url = state.base_grant_url + '?continue_url=' + encodeURIComponent(state.user_continue_url);
          setStatus('Открываем страницу авторизации…', true);
          location.href = url; return;
        }
        // Вариант B: общий grant_url (UniFi/MikroTik)
        if(state.grant_url){
          const url = state.grant_url + (state.user_continue_url ? ('?continue_url=' + encodeURIComponent(state.user_continue_url)) : '');
          setStatus('Завершаем авторизацию…', true);
          location.href = url; return;
        }
        // Вариант C: success_url как запасной
        if(state.success_url){
          setStatus('Переходим к выданному success_url…', true);
          location.href = state.success_url; return;
        }
        // Нет параметров — вероятно вы не за captive‑порталом
        alert('Похоже, эта страница открыта не из гостевой сети с порталом. Подключитесь к Wi‑Fi с порталом и попробуйте снова.');
        setStatus('Не обнаружены параметры портала.');
      }catch(e){
        console.error(e); setStatus('Ошибка: не удалось завершить подключение.');
      }
    }

    (function init(){
      showContext();
      const btn = $('connectBtn');
      btn.addEventListener('click', connect);
      if(state.base_grant_url || state.grant_url || state.success_url){
        setStatus('Параметры портала обнаружены. Можно подключаться.', true);
        enable(btn);
      }else{
        setStatus('Ожидание параметров портала в строке запроса…');
      }
    })();
  </script>
</body>
</html>
