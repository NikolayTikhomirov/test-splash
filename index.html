<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connect to the Internet — Captive Portal Helper</title>
  <meta name="description" content="Single-click helper page for captive portals (Meraki/UniFi/MikroTik/Coova). Fill or auto-detect parameters and press Connect." />
  <style>
    :root{--bg:#0b0f19;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--brand:#60a5fa;--brand2:#34d399}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);
      background:radial-gradient(1000px 700px at 80% -20%, #1f2937 0%, transparent 60%),
                 radial-gradient(700px 500px at -20% 100%, #0f766e 0%, transparent 60%), var(--bg);
      display:grid;place-items:center;padding:24px}
    .wrap{max-width:880px;width:100%}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.1);
      border-radius:22px;padding:30px;backdrop-filter:blur(6px);box-shadow:0 16px 50px rgba(0,0,0,.35)}
    h1{margin:0 0 10px;font-size:clamp(26px,4vw,40px)}
    p{margin:8px 0 0;color:var(--muted)}
    .grid{display:grid;gap:12px;margin-top:16px;grid-template-columns:1fr 1fr}
    .grid.full{grid-template-columns:1fr}
    label{font-size:13px;color:#cbd5e1}
    .input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.16);background:#0d1320;color:var(--text);outline:none}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .btn{appearance:none;border:none;cursor:pointer;border-radius:12px;padding:12px 16px;font-size:15px;font-weight:700;
      background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0b0f19;transition:transform .08s ease, box-shadow .2s ease;
      box-shadow:0 10px 25px rgba(96,165,250,.35)}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,.2);color:var(--text);box-shadow:none}
    .status{margin-top:14px;font-size:14px;color:var(--muted)}
    .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:#0d1320;border:1px solid rgba(255,255,255,.14)}
    .ok{color:#a7f3d0}
    .err{color:#fca5a5}
    .tos{display:flex;align-items:center;gap:8px;margin-top:10px;font-size:14px;color:#cbd5e1}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" role="region" aria-labelledby="title">
      <h1 id="title">Connect to the Internet</h1>
      <p>This helper page works with captive portals. Detect params from the URL or enter them below, then press <em>Connect</em>.</p>

      <div class="badges" id="detected"></div>

      <div class="grid full">
        <div>
          <label for="base_grant_url">Meraki <code>base_grant_url</code></label>
          <input class="input" id="base_grant_url" type="url" placeholder="https://example.com/meraki/grant" />
        </div>
        <div>
          <label for="user_continue_url">Continue URL (<code>user_continue_url</code>/<code>continue_url</code>)</label>
          <input class="input" id="user_continue_url" type="url" placeholder="https://example.com/" value="https://example.com/" />
        </div>
        <div>
          <label for="grant_url">Generic <code>grant_url</code> (UniFi/MikroTik)</label>
          <input class="input" id="grant_url" type="url" placeholder="https://example.com/portal/grant" />
        </div>
        <div>
          <label for="success_url"><code>success_url</code> (fallback)</label>
          <input class="input" id="success_url" type="url" placeholder="https://example.com/ok" />
        </div>
      </div>

      <label class="tos"><input id="accept_tos" type="checkbox" /> I accept the Terms of Service</label>

      <div class="actions">
        <button class="btn" id="connectBtn">Connect</button>
        <button class="btn secondary" id="loadBtn" type="button">Load from current URL</button>
        <button class="btn secondary" id="demoBtn" type="button">Fill demo values</button>
        <button class="btn secondary" id="resetBtn" type="button">Reset</button>
      </div>

      <p class="status" id="status">Waiting for input…</p>
    </section>
  </main>

  <script>
    const qs = new URLSearchParams(location.search);
    const $ = (id)=>document.getElementById(id);

    function setStatus(msg, ok){
      const el=$('status'); el.textContent=msg; el.className='status'+(ok?' ok':'');
    }

    function setDetected(){
      const list=[];
      if(qs.get('base_grant_url')) list.push('Detected: base_grant_url');
      if(qs.get('user_continue_url')||qs.get('continue_url')) list.push('Detected: continue_url');
      if(qs.get('grant_url')) list.push('Detected: grant_url');
      if(qs.get('success_url')) list.push('Detected: success_url');
      $('detected').innerHTML = list.map(t=>`<span class="badge">${t}</span>`).join('');
    }

    function loadFromURL(){
      $('base_grant_url').value = qs.get('base_grant_url') || '';
      $('user_continue_url').value = qs.get('user_continue_url') || qs.get('continue_url') || $('user_continue_url').value;
      $('grant_url').value = qs.get('grant_url') || '';
      $('success_url').value = qs.get('success_url') || '';
      setDetected();
      setStatus('Parameters loaded from current URL.', true);
    }

    function fillDemo(){
      $('base_grant_url').value = 'https://example.com/meraki/grant';
      $('user_continue_url').value = 'https://example.com/';
      $('grant_url').value = '';
      $('success_url').value = '';
      setStatus('Demo values filled. Press Connect to see the redirect URL in your address bar.', true);
    }

    function resetAll(){
      ['base_grant_url','user_continue_url','grant_url','success_url'].forEach(id=>$ (id).value='');
      $('user_continue_url').value = 'https://example.com/';
      setStatus('Reset done.');
    }

    function joinUrl(base, key, val){
      if(!val) return base; const hasQ = base.includes('?');
      return base + (hasQ?'&':'?') + key + '=' + encodeURIComponent(val);
    }

    function connect(){
      try{
        if(!$('accept_tos').checked){
          alert('Please accept the Terms of Service to continue.');
          return;
        }
        const base_grant_url = $('base_grant_url').value.trim();
        const continue_url = $('user_continue_url').value.trim();
        const grant_url = $('grant_url').value.trim();
        const success_url = $('success_url').value.trim();

        if(base_grant_url){
          const url = joinUrl(base_grant_url,'continue_url',continue_url);
          setStatus('Redirecting to Meraki base_grant_url…', true);
          location.assign(url); return;
        }
        if(grant_url){
          const url = continue_url ? joinUrl(grant_url,'continue_url',continue_url) : grant_url;
          setStatus('Redirecting to grant_url…', true);
          location.assign(url); return;
        }
        if(success_url){
          setStatus('Opening success_url…', true);
          location.assign(success_url); return;
        }
        setStatus('No parameters provided. Enter a URL above or click “Load from current URL”.');
      }catch(e){
        console.error(e); setStatus('Error: failed to complete connection.');
      }
    }

    // Wire up
    $('connectBtn').addEventListener('click', connect);
    $('loadBtn').addEventListener('click', loadFromURL);
    $('demoBtn').addEventListener('click', fillDemo);
    $('resetBtn').addEventListener('click', resetAll);

    // Initial
    setDetected();
    if(qs.size){ loadFromURL(); }
  </script>
</body>
</html>
